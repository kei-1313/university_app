<div class="post-index all-wrapper">
  <div class="post-index-two-columns">
    <div class="post-index-container">
      <div class="post-index-title all-title">
        <h2>投稿一覧</h2>
      </div>
      <%# 検索機能 %>
      <div class="search-form">
        <%= form_with url: search_posts_path, method: :get, local: true do |f| %> <%# データベースに保存しない %>
          <%= f.text_field :search, placeholder: '投稿を検索する', class: 'seach-text-field' %>
          <%= f.submit '検索', class: 'seach-submit' %>
        <% end  %>
      </div>

      <% @posts.each do |post| %>
        <div class="post-index-link">
          <%= link_to post_path(post), class: 'link_to_allpost' do %>
            <div class="post-index-content">
              <div class="post-index-image">
                <% if post.post_photo.attached? %>
                  <%= image_tag post.post_photo, class: 'post-index-img' %>
                <% else %>
                  <%= image_tag 'nothing-image.png', class: 'post-index-img' %>
                <% end %>
              </div>

              <div class="post-index-title">
                <%= post.title %>
              </div>
            </div>
            <div class="post-index-info-container">
              <div class="tag-container">
                <% post.tags.each do |tag| %>
                  <%= link_to post_tag_path(post, tag), class: 'post-tag-index' do %>
                  <span><%= tag.tag_name %></span>
                  <% end %>
                <% end %> 
              </div>

              <div class="post-time-like-comment-container">
                <span class="post-index-info"><i class="fas fa-heart"></i><%= post.likes.count %></span>

                <span class="post-index-info"><i class="fas fa-comments"></i><%= post.comments.count %></span>
                
                <span class="post-index-info"><%= post.created_at.strftime("%Y年%m月%d日%H時%M分") %></span>
              </div>

            </div>
          <% end %>
        </div> 
      <% end %>
    </div>

    <div class="post-index-sub-colums">
      <div class="post-index-sub-colums-container">
        <div class="post-ranking-heading">
          <h2>人気投稿</h2>
        </div>

        <% @rankings.each.with_index(1) do |ranking, i| %>
         <%= link_to post_path(ranking), class: 'post-ranking-link' do %>
            <div class="post-ranking">
              <div class="post-ranking-image-container">
                <% if ranking.post_photo.attached? %>
                  <%= image_tag ranking.post_photo, class: 'post-ranking-image' %>
                <% else %>
                  <%= image_tag 'nothing-image.png', class: 'post-ranking-image' %>
                <% end %>

                <span class="ranking-number"><%= i %></span>
              </div>
              <div class="post-ranking-title-container">
                <p class="post-ranking-title"><%= ranking.title %></p>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>

      <div class="post-tags-list-cotainer">
        <div class="post-tags-list-title">
          <h2>タグ一覧</h2>
        </div>

        <div class="post-tags-list">
          <% @tags.each do |tag| %>
            <%= link_to post_tag_path(tag.posts, tag), class: 'post-tags-list-link' do  %>
              <span class="post-tags-list-of-tag"><%= tag.tag_name %></span>
            <% end %>
          <% end %>
        </div>
     </div>

    </div>
  </div>
  <div class="pagination-container">
    <%= paginate @posts %>
  </div>
</div>

